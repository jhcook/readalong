# US3.1: Align Spoken Words to Text

## State
DRAFT

## Problem Statement
Raw STT output might not perfectly match the source text due to noise or minor speech variations. We need a robust alignment step to map the known text tokens to the audio timestamps.

## User Story
As a system I want to align timestamps to text tokens So that highlighting is accurate.

## Acceptance Criteria
- [ ] **AC1**: Alignment uses Whisper timestamps or Gentle/Aeneas.
- [ ] **AC2**: Alignment handles skipped words gracefully.
- [ ] **AC3**: Alignment produces a confidence score per word.
- [ ] **AC4**: Alignment is stored for reuse.

## Non-Functional Requirements
- Accuracy (>95% word alignment)
### Security
- [ ] No PII in logs
- [ ] No secrets in code
- [ ] Compliance docs checked if applicable
### Compliance
- [ ] No PII in logs
- [ ] No secrets in code
- [ ] Compliance docs checked if applicable
### Observability
- [ ] Is OpenTelemetry added for new flows?
- [ ] Are logs structured and governed?

## Linked ADRs
- ADR-003: Use Forced Alignment for Wordâ€‘Level Highlighting
- ADR-009: Use a Unified Alignment Map Format

## Impact Analysis Summary
Components touched: Alignment Engine
Workflows affected: Post-processing of audio
Risks identified: "Hallucinations" in Whisper timestamps causing desync.
**Architect Governance**:
- [ ] Do ADRs exist for major changes?
- [ ] Are architectural boundaries respected?
**Product Governance**:
- [ ] Are Acceptance Criteria clear and testable?
- [ ] Is the Impact Analysis complete?

## Test Strategy
How will we verify correctness?
- Test with "perfect" reading and "imperfect" reading samples.
- Verify JSON output against ADR-009 schema.

**QA Governance**:
- [ ] Are there new tests for new features?
- [ ] Is the Test Strategy section in the Story comprehensive?

## Rollback Plan
How do we revert safely?
- Revert alignment logic changes.
