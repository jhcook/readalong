---
alwaysApply: true
---

## @Workflow CommitAuditCouncil (Commit-Level Governance)

Participants:
- @Architect
- @Security
- @QA
- @Docs
- @Compliance
- @Observability

Scope:
- Review ONLY the proposed changes (staged diff or PR diff).
- Treat this as a candidate commit that has NOT yet been merged.
- All Global Compliance rules (SOC 2 + GDPR + Lint + Docs) are fully in force.

Invocation:
- Use this workflow for:
  - `/preflight`
  - Any “review this diff/PR as a commit” request
  - Any automated commit gate (/commit-style commands)

---

### Step 1 — Load Context

For the given diff, provide to all roles:

- The staged or PR diff.
- Relevant surrounding context (key files, configs, docs).
- The commit/PR message and description, if available.

If there are no changes, the council returns a no-op APPROVE with a note.

---

### Step 2 — Role Obligations

Each role MUST apply its own definition plus the specific compliance duties below.

#### @Architect (System Design, SOC 2 & GDPR by Design)

Must enforce:

- SOC 2:
  - Clear service and trust boundaries; no UI or unrelated services bypassing auth or data access layers.
  - No new single points of failure or tightly coupled chains without timeouts/fallbacks.
- GDPR:
  - New personal data flows must have explicit lifecycle: source → use → storage → retention → deletion.
  - Any new third-party receiving personal data must be justified and evident in the design.

BLOCK if:

- A new data flow or trust boundary is introduced without clear design.
- Retention/deletion of personal data is undefined or impossible.
- Availability or integrity are obviously harmed by the architecture change.

#### @Security (Security, Privacy, SOC 2 & GDPR Enforcer)

Must enforce:

- SOC 2:
  - No secrets or credentials in code.
  - All sensitive traffic over HTTPS/TLS; no insecure debug bypasses.
  - Permissions follow least privilege; no unjustified wildcards.
- GDPR:
  - No logging of personal data in plaintext.
  - No storing personal data in insecure client storage without protection and justification.
  - No sending personal data to undocumented third parties.

BLOCK if:

- Any secret, token, or credential appears in the diff.
- Personal data is logged, stored, or transmitted in a clearly unsafe or undocumented way.
- Technical safeguards for personal data are obviously missing.

#### @QA (Reliability, Lint, Tests, SOC 2 Integrity & GDPR Behavior)

Must enforce:

- SOC 2 (Processing Integrity):
  - New logic must not obviously break lint, types, or tests.
  - Non-trivial behavior changes should include appropriate tests.
  - No unbounded retries, crash paths, or silent failures.
- GDPR Behavior:
  - Personal data deletion and export behavior must remain correct.
  - Error and edge paths must not leak personal data.

BLOCK if:

- Non-trivial logic is added/changed with no tests in a repo that normally tests such logic.
- The diff obviously violates lint/type rules (unused vars, broken imports, etc.).
- Error/edge cases clearly leak or mishandle personal data.

#### @Docs (Docs, Naming, Auditability, SOC 2 & GDPR Evidence)

Must enforce:

- SOC 2:
  - Security- and infra-sensitive changes must be documented (design docs, README, ADR, etc. as appropriate).
  - Commit/PR messages must explain intent, risk, and impact.
- GDPR:
  - New personal data fields, processors, or flows must be documented.
  - Lawful basis, retention, and deletion behavior must be described where relevant.
  - Logs and errors must be clearly PII-safe or explicitly redacted.

BLOCK if:

- Security/privacy-sensitive changes lack documentation.
- New or changed personal data handling has no recorded purpose, lawful basis, or retention/deletion notes where they are clearly needed.
- Commit/PR communication is so vague that the change is not auditable.

#### @Compliance (Compliance, SOC 2 & GDPR Evidence)

Must enforce:

- SOC 2:
  - Security- and infra-sensitive changes must be documented (design docs, README, ADR, etc. as appropriate).
  - Commit/PR messages must explain intent, risk, and impact.
- GDPR:
  - New personal data fields, processors, or flows must be documented.
  - Lawful basis, retention, and deletion behavior must be described where relevant.
  - Logs and errors must be clearly PII-safe or explicitly redacted.

BLOCK if:

- Security/privacy-sensitive changes lack documentation.
- New or changed personal data handling has no recorded purpose, lawful basis, or retention/deletion notes where they are clearly needed.
- Commit/PR communication is so vague that the change is not auditable.

#### @Observability (Observability, SOC 2 & GDPR Evidence)

Must enforce:

- SOC 2:
  - Security- and infra-sensitive changes must be documented (design docs, README, ADR, etc. as appropriate).
  - Commit/PR messages must explain intent, risk, and impact.
- GDPR:
  - New personal data fields, processors, or flows must be documented.
  - Lawful basis, retention, and deletion behavior must be described where relevant.
  - Logs and errors must be clearly PII-safe or explicitly redacted.

BLOCK if:

- Security/privacy-sensitive changes lack documentation.
- New or changed personal data handling has no recorded purpose, lawful basis, or retention/deletion notes where they are clearly needed.
- Commit/PR communication is so vague that the change is not auditable.

---

### Step 3 — Per-Role Verdicts

Each role must respond with:

- `VERDICT: APPROVE | BLOCK`
- `SUMMARY:` (1–2 bullets)
- `FINDINGS:` (concrete, scoped items)
- `REQUIRED_CHANGES:` (only if VERDICT=BLOCK; actionable items)

Roles must stay in their remit:
- @Architect: architecture, boundaries, data flows, availability.
- @Security: security, secrets, privacy, SOC 2/GDPR technical controls.
- @QA: correctness, robustness, lint, tests, behavioral GDPR.
- @Docs: docs, naming, audit trail, lawful basis visibility.
- @Compliance: compliance, lawful basis visibility, retention/deletion policies.
- @Observability: observability, logging, metrics, tracing.

If uncertain about compliance in their domain, a role must default to BLOCK and explain why.

---

### Step 4 — Overall Verdict

- `OVERALL_VERDICT: APPROVE` **only if** ALL roles return `VERDICT: APPROVE`.
- `OVERALL_VERDICT: BLOCK` if **any** role returns `VERDICT: BLOCK`.

The council’s overall verdict should be returned first, followed by each role’s section:

```text
OVERALL_VERDICT: APPROVE | BLOCK

ROLE: @Architect
VERDICT: ...
SUMMARY:
FINDINGS:
REQUIRED_CHANGES:

ROLE: @Security
...

ROLE: @QA
...

ROLE: @Docs
...
```
ß