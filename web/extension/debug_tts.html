<!DOCTYPE html>
<html>
<head>
    <title>TTS Debug</title>
</head>
<body>
    <button id="speakBtn">Speak</button>
    <div id="log"></div>
    <script>
        const btn = document.getElementById('speakBtn');
        const log = document.getElementById('log');
        
        function logMsg(msg) {
            const p = document.createElement('p');
            p.textContent = msg;
            log.appendChild(p);
            console.log(msg); // also to console for agent capture
        }

        btn.onclick = () => {
            logMsg('Starting...');
            const text = "Hello world this is a test of the emergency broadcast system.";
            const u = new SpeechSynthesisUtterance(text);
            
            u.onstart = () => logMsg('Event: start');
            u.onend = () => logMsg('Event: end');
            u.onboundary = (e) => {
                logMsg(`Event: boundary - name: ${e.name}, charIndex: ${e.charIndex}`);
            };
            
            const voices = window.speechSynthesis.getVoices();
            logMsg(`Voices count: ${voices.length}`);
            if (voices.length > 0) {
                 const v = voices.find(v => v.name.includes('Google US English')) || voices.find(v => v.lang.startsWith('en'));
                 if (v) {
                    u.voice = v;
                    logMsg(`Selected voice: ${v.name}`);
                 } else {
                    logMsg('No generic English voice found');
                 }
            } else {
                logMsg('No voices loaded yet (synchronous check)');
            }

            window.speechSynthesis.speak(u);
        };
        
        // Ensure voices load
        window.speechSynthesis.getVoices();
    </script>
</body>
</html>
